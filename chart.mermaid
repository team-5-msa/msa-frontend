%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor':'#e8f0fe', 'primaryBorderColor':'#1e88e5', 'primaryTextColor':'#0d47a1', 'lineColor':'#1e88e5', 'secondBkgColor':'#fff3e0', 'tertiaryColor':'#f3e5f5', 'tertiaryBorderColor':'#6a1b9a', 'tertiaryTextColor':'#1a237e', 'fontSize':'16px', 'fontFamily': 'arial'}, 'sequence': {'diagramMarginX': 50, 'diagramMarginY': 50, 'mirrorActors': true, 'actorFontSize': 16}}}%%
sequenceDiagram
    actor Client as ğŸ­ í´ë¼ì´ì–¸íŠ¸
    participant Gateway as ğŸŒ API Gateway
    participant Booking as ğŸ« Booking Service
    participant Performance as ğŸª Performance Service
    participant Payment as ğŸ’³ Payment Service

    rect rgb(232, 245, 233)
    Client->>Gateway: POST /bookings
    Gateway->>Booking: ì˜ˆë§¤ ìš”ì²­ ì „ë‹¬
    Note over Client,Booking: ğŸ“¤ ì˜ˆë§¤ ìš”ì²­ ì‹œì‘
    end
    
    rect rgb(225, 245, 254)
    Booking->>Performance: 1ï¸âƒ£ GET /performances/:id
    Note over Booking,Performance: ê³µì—° ì •ë³´ ì¡°íšŒ
    Performance-->>Booking: âœ… { id: 1, title: 'ê³µì—° íƒ€ì´í‹€', description: 'ê³µì—° ì„¤ëª…', category: 'CONCERT'<br/>venue: 'ê³µì—° ì¥ì†Œ', imageUrl: 'https://image.url', price: 154000, totalSeats: 450, availableSeats: 450 }
    end
    
    rect rgb(255, 235, 238)
    Booking->>Performance: 2ï¸âƒ£ POST /reservations/:performanceId
    Note over Booking,Performance: ì¢Œì„ ì„ì‹œ ì˜ˆì•½ ì‹ ì²­
    Performance->>Performance: âš™ï¸ ì¢Œì„ ì°¨ê° (450 â†’ 447)
    Performance-->>Booking: âœ… { "performanceId": 1, "reservationId": 1, "title": "ê³µì—° íƒ€ì´í‹€", "price": 154000, "availableSeats": 447, "status": "PENDING" }
    end
    
    rect rgb(255, 243, 224)
    Booking->>Payment: 3ï¸âƒ£ POST /payments/execute
    Note over Booking,Payment: ğŸ’° ê²°ì œ ì²˜ë¦¬
    Payment-->>Booking: âœ… ê²°ì œ ì„±ê³µ | transactionId: "TXN-99999"
    end
    
    rect rgb(232, 245, 233)
    Booking->>Performance: 4ï¸âƒ£ PATCH /reservations/:performanceId/:reservationId/confirm
    Note over Booking,Performance: ì˜ˆì•½ ìµœì¢… í™•ì •
    Performance->>Performance: âœ”ï¸ ì¢Œì„ í™•ì • (447 ìœ ì§€)
    Performance-->>Booking: âœ… ì˜ˆì•½ ìƒíƒœ: CONFIRMED
    end

    rect rgb(225, 245, 254)
    Booking-->>Client: ğŸ‰ ì˜ˆë§¤ ì™„ë£Œ ì‘ë‹µ
    Note over Gateway,Client: âœ¨ ì˜ˆë§¤ ì„±ê³µ!
    end